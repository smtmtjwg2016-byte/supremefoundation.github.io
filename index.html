<script>
/* One-time SW & cache killer */
(async () => {
  try {
    if ('serviceWorker' in navigator) {
      const regs = await navigator.serviceWorker.getRegistrations();
      for (const r of regs) { await r.unregister(); }
    }
    if (window.caches && caches.keys) {
      const keys = await caches.keys();
      await Promise.all(keys.map(k => caches.delete(k)));
    }
    // cache-buster for this load
    if (!location.search.includes('nocache=1')) {
      location.replace(location.pathname + '?nocache=1');
    }
  } catch (e) {
    console.log('SW clear error', e);
  }
})();
</script>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Volunteer Resignation Form</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 800px; margin: 30px auto; padding: 0 16px; background:#f9fafb; }
  h2 { text-align: center; }
  form { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  label { font-weight: 600; margin-top: 10px; display: block; }
  input, select, textarea { width: 100%; padding: 10px; margin-top: 4px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
  button { margin-top: 15px; padding: 10px 18px; background:#1d4ed8; color:#fff; border:none; border-radius:6px; cursor:pointer; }
  button:hover { background:#2563eb; }
  #msg { margin-top: 15px; font-weight: 600; }
</style>
</head>
<body>
  <h2>Volunteer Resignation Submission</h2>
  <form id="resignForm">
    <label>SR No.</label>
    <input type="text" name="srNo" required>

    <label>Date of Resignation</label>
    <input type="date" name="dateISO" required>

    <label>Volunteer Name</label>
    <input type="text" name="volunteerName" required>

    <label>Location</label>
    <select name="location" required>
      <option value="">-- Select Location --</option>
      <option>LADNUN</option>
      <option>KBBS</option>
      <option>JHUNJHUNU</option>
      <option>ADNT</option>
      <option>BHG</option>
    </select>

    <label>Coordinator Name</label>
    <select name="coordinatorName" required>
      <option value="">-- Select Coordinator --</option>
      <option>DILEEP SINGH CHOUHAN</option>
      <option>KEDAR PANDEY</option>
      <option>BALBIR SHARMA</option>
      <option>VISHNU SHARMA</option>
      <option>ROHIT SHARMA</option>
    </select>

    <label>Resignation Letter (PDF/Image)</label>
    <input type="file" id="file" accept="application/pdf,image/*" required>

    <label>Reason for Leaving</label>
    <textarea name="reason" rows="3" required></textarea>

    <button type="submit">Submit</button>
    <div id="msg"></div>
  </form>

<script>
// ======= YOUR GOOGLE APPS SCRIPT WEB APP URL =======
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbybVCtJ7LtUvzVUSDsT_lZh9Mqc1RDaOn5tsWR5Bgt-tXuGUyIn7nOskr76uW0xYlXKhA/exec";

const form = document.getElementById('resignForm');
const msg = document.getElementById('msg');

form.addEventListener('submit', function(ev){
  ev.preventDefault();
  const f = ev.target;
  const file = document.getElementById('file').files[0];
  if (!file) { msg.textContent = 'Please attach a file.'; return; }

  const reader = new FileReader();
  reader.onload = function() {
    const payload = {
      srNo: f.srNo.value.trim(),
      volunteerName: f.volunteerName.value.trim(),
      location: f.location.value.trim(),
      coordinatorName: f.coordinatorName.value.trim(),
      dateISO: f.dateISO.value,
      reason: f.reason.value.trim(),
      file: { name: file.name, mimeType: file.type, dataUrl: reader.result }
    };

    msg.textContent = 'Submitting...';

   fetch(WEB_APP_URL, {
  method: 'POST',
  // application/json ‡§ï‡•á ‡§¨‡§ú‡§æ‡§Ø text/plain ‡§∞‡§ñ‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø CORS preflight ‡§® ‡§π‡•ã
  headers: { 'Content-Type': 'text/plain;charset=UTF-8' },
  body: JSON.stringify(payload)
})
.then(async (r) => {
  const text = await r.text();
  if (!r.ok) throw new Error(text || ('HTTP ' + r.status));
  try { return JSON.parse(text); } catch { return { ok: true, message: text }; }
})
.then(res => {
  if (res && res.ok) { msg.style.color='green'; msg.textContent='Submitted successfully!'; form.reset(); }
  else { throw new Error(res && res.error ? res.error : 'Unknown error'); }
})
.catch(err => { msg.style.color='red'; msg.textContent='Submit failed: ' + err.message; });
<script>
/* üëá ‡§Ö‡§™‡§®‡•á Apps Script ‡§µ‡•á‡§¨‡§ê‡§™ ‡§ï‡§æ URL ‡§Ø‡§π‡§æ‡§Å ‡§°‡§æ‡§≤‡•á‡§Ç */
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbybVCtJ7LtUvzVUSDsT_lZh9Mqc1RDaOn5tsWR5Bgt-tXuGUyIn7nOskr76uW0xYlXKhA/exec";

const form = document.getElementById('resignForm');
const msg = document.getElementById('msg');

form.addEventListener('submit', function(ev){
  ev.preventDefault();

  const f = ev.target;
  const file = document.getElementById('file').files[0];
  if (!file) {
    msg.style.color = 'red';
    msg.textContent = '‚ö†Ô∏è ‡§ï‡•É‡§™‡§Ø‡§æ ‡§´‡§º‡§æ‡§á‡§≤ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç (PDF ‡§Ø‡§æ Image)‡•§';
    return;
  }

  const reader = new FileReader();
  reader.onload = function() {
    // Form ‡§ï‡§æ ‡§°‡•á‡§ü‡§æ ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç
    const payload = {
      srNo: f.srNo.value.trim(),
      volunteerName: f.volunteerName.value.trim(),
      location: f.location.value.trim(),
      coordinatorName: f.coordinatorName.value.trim(),
      dateISO: f.dateISO.value,
      reason: f.reason.value.trim(),
      file: {
        name: file.name,
        mimeType: file.type,
        dataUrl: reader.result
      }
    };

    msg.style.color = 'black';
    msg.textContent = '‚è≥ Submitting...';

    // Fetch ‚Äî text/plain ‡§§‡§æ‡§ï‡§ø preflight ‡§® ‡§π‡•ã
    fetch(WEB_APP_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=UTF-8' },
      body: JSON.stringify(payload)
    })
    .then(async (r) => {
      const text = await r.text();
      if (!r.ok) throw new Error(text || ('HTTP ' + r.status));
      try {
        return JSON.parse(text);
      } catch {
        return { ok: true, message: text };
      }
    })
    .then(res => {
      if (res && res.ok) {
        msg.style.color = 'green';
        msg.textContent = '‚úÖ ‡§´‡§º‡•â‡§∞‡•ç‡§Æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§π‡•Å‡§Ü!';
        f.reset();
      } else {
        throw new Error(res && res.error ? res.error : 'Unknown error');
      }
    })
    .catch(err => {
      msg.style.color = 'red';
      msg.textContent = '‚ùå Submit failed: ' + err.message;
      console.error(err);
    });
  };

  /* ‡§Ø‡§π ‡§≤‡§æ‡§á‡§® ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•ã Base64 ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§ï‡§∞ reader.onload ‡§™‡§∞ ‡§≠‡•á‡§ú‡§§‡•Ä ‡§π‡•à */
  reader.readAsDataURL(file);
});
</script>
