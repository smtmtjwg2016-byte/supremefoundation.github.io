<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Volunteer Resignation Form</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 800px; margin: 30px auto; padding: 0 16px; background:#f9fafb; }
  h2 { text-align: center; }
  form { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  label { font-weight: 600; margin-top: 10px; display: block; }
  input, select, textarea { width: 100%; padding: 10px; margin-top: 4px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
  button { margin-top: 15px; padding: 10px 18px; background:#1d4ed8; color:#fff; border:none; border-radius:6px; cursor:pointer; }
  button:hover { background:#2563eb; }
  #msg { margin-top: 15px; font-weight: 600; }
</style>

<!-- One-time: à¤ªà¥à¤°à¤¾à¤¨à¤¾ service worker à¤¹à¤Ÿà¤¾à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ -->
<script>
(async () => {
  try {
    if ('serviceWorker' in navigator) {
      const regs = await navigator.serviceWorker.getRegistrations();
      for (const r of regs) await r.unregister();
    }
    if (window.caches && caches.keys) {
      const keys = await caches.keys();
      await Promise.all(keys.map(k => caches.delete(k)));
    }
    if (!location.search.includes('nocache=1')) {
      history.replaceState(null, '', location.pathname + '?nocache=1');
    }
  } catch(e) { console.log('SW clear error', e); }
})();
</script>
</head>

<body>
  <h2>Volunteer Resignation Submission</h2>
  <form id="resignForm">
    <label>SR No.</label>
    <input type="text" name="srNo" required>

    <label>Date of Resignation</label>
    <input type="date" name="dateISO" required>

    <label>Volunteer Name</label>
    <input type="text" name="volunteerName" required>

    <label>Location</label>
    <select name="location" required>
      <option value="">-- Select Location --</option>
      <option>LADNUN</option>
      <option>KBBS</option>
      <option>JHUNJHUNU</option>
      <option>ADNT</option>
      <option>BHG</option>
    </select>

    <label>Coordinator Name</label>
    <select name="coordinatorName" required>
      <option value="">-- Select Coordinator --</option>
      <option>DILEEP SINGH CHOUHAN</option>
      <option>KEDAR PANDEY</option>
      <option>BALBIR SHARMA</option>
      <option>VISHNU SHARMA</option>
      <option>ROHIT SHARMA</option>
    </select>

    <label>Resignation Letter (PDF/Image)</label>
    <input type="file" id="file" accept="application/pdf,image/*" required>

    <label>Reason for Leaving</label>
    <textarea name="reason" rows="3" required></textarea>

    <button type="submit">Submit</button>
    <div id="msg"></div>
  </form>

<script>
// ðŸ‘‰ à¤…à¤ªà¤¨à¤¾ Apps Script Web App /exec URL à¤¯à¤¹à¤¾à¤ à¤°à¤–à¥‡à¤‚:
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbybVCtJ7LtUvzVUSDsT_lZh9Mqc1RDaOn5tsWR5Bgt-tXuGUyIn7nOskr76uW0xYlXKhA/exec";

const form = document.getElementById('resignForm');
const msg  = document.getElementById('msg');

form.addEventListener('submit', function(ev){
  ev.preventDefault();
  const f = ev.target;
  const file = document.getElementById('file').files[0];
  if (!file) { msg.style.color='red'; msg.textContent='Please attach a file.'; return; }

  const reader = new FileReader();
  reader.onload = function() {
    const payload = {
      srNo: f.srNo.value.trim(),
      volunteerName: f.volunteerName.value.trim(),
      location: f.location.value.trim(),
      coordinatorName: f.coordinatorName.value.trim(),
      dateISO: f.dateISO.value,
      reason: f.reason.value.trim(),
      file: { name: file.name, mimeType: file.type, dataUrl: reader.result }
    };

    msg.style.color='black';
    msg.textContent = 'Submitting...';

    fetch(WEB_APP_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=UTF-8' }, // simple request (no CORS preflight)
      body: JSON.stringify(payload)
    })
    .then(async (r) => {
      const text = await r.text();
      if (!r.ok) throw new Error(text || ('HTTP ' + r.status));
      try { return JSON.parse(text); } catch { return { ok: true, message: text }; }
    })
    .then(res => {
      if (res && res.ok) {
        msg.style.color='green';
        msg.textContent='Submitted successfully!';
        f.reset();
      } else {
        throw new Error(res && res.error ? res.error : 'Unknown error');
      }
    })
    .catch(err => {
      msg.style.color='red';
      msg.textContent='Submit failed: ' + err.message;
      console.error(err);
    });
  };

  // à¤«à¤¼à¤¾à¤‡à¤² à¤•à¥‹ Base64 à¤®à¥‡à¤‚ à¤ªà¤¢à¤¼à¥‡à¤‚
  reader.readAsDataURL(file);
});
</script>
</body>
</html>
